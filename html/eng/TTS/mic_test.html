<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìŒì„± ë…¹ìŒ</title>
</head>
<body>
  <button id="recordBtn">ğŸ¤ ë…¹ìŒ ì‹œì‘</button>
  <audio id="audioPlayer" controls></audio>

  <script>
    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];

    const recordBtn = document.getElementById("recordBtn");
    const audioPlayer = document.getElementById("audioPlayer");

    recordBtn.addEventListener("click", async () => {
      if (!isRecording) {
        // ğŸ¤ ë…¹ìŒ ì‹œì‘
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = event => {
          audioChunks.push(event.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(audioChunks, { type: 'audio/webm' });
          const url = URL.createObjectURL(blob);
          audioPlayer.src = url;

          // ğŸ“¨ ì„œë²„ë¡œ ì—…ë¡œë“œ
          const formData = new FormData();
          formData.append('audio', blob, 'recording.webm');

          fetch('http://localhost:5000/upload', {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            console.log('ë¶„ì„ ê²°ê³¼:', data);
            alert('ì—…ë¡œë“œ ì™„ë£Œ! pitch: ' + data.pitch + ', energy: ' + data.energy);
          });
        };

        mediaRecorder.start();
        isRecording = true;
        recordBtn.textContent = "â¹ï¸ ë…¹ìŒ ì •ì§€";

      } else {
        // â¹ï¸ ë…¹ìŒ ì¢…ë£Œ
        mediaRecorder.stop();
        isRecording = false;
        recordBtn.textContent = "ğŸ¤ ë…¹ìŒ ì‹œì‘";
      }
    });
    navigator.mediaDevices.enumerateDevices()
  .then(devices => {
    const audioInputs = devices.filter(device => device.kind === 'audioinput');
    console.log("ë§ˆì´í¬ ì¥ì¹˜ ëª©ë¡:", audioInputs);
    if (audioInputs.length === 0) {
      alert("ë§ˆì´í¬ ì¥ì¹˜ê°€ ê°ì§€ë˜ì§€ ì•Šì•˜ì–´ìš” ğŸ˜¥");
    } else {
      alert(`ë§ˆì´í¬ ${audioInputs.length}ê°œ ë°œê²¬ë¨! ì½˜ì†”ì—ì„œ í™•ì¸í•´ ë³´ì„¸ìš”.`);
    }
  });
  navigator.mediaDevices.enumerateDevices()
  .then(devices => {
    const mics = devices.filter(d => d.kind === 'audioinput');
    console.log("ë§ˆì´í¬ ì¥ì¹˜:", mics);
  });
  </script>
</body>
</html>
