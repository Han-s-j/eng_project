<!-- ì„œë²„ì—ì„œ ë³´ë‚´ëŠ” JSONí˜•íƒœì˜ ë¶„ì„ê²°ê³¼ ë°›ê³  ì‹œê°í™”í•˜ê¸°-->
<!-- TTSíŒŒì¼ ì „ë‹¬ë°›ê³  ì¬ìƒí•˜ê¸°  -->

<!DOCTYPE html>
<html>
<head>
  <title>ê°•ì„¸ ë¶„ì„</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>ê°•ì„¸ ë¶„ì„ ì‹œê°í™”</h2>
  <input id="inputText" placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" size="50"/>
  <button onclick="analyzeText()">ë¶„ì„í•˜ê¸°</button>
  <audio id="ttsAudio" controls style="display: none;"></audio>

  <canvas id="stressChart" width="600" height="400"></canvas>

  <script>
    async function analyzeText() {
      const text = document.getElementById("inputText").value;

      const response = await fetch("http://localhost:5000/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: text })
      });

      const data = await response.json();
      console.log(data);

      const audio = document.getElementById("ttsAudio");
      audio.src = `http://localhost:5000${data.tts_url}`;
      audio.style.display = "block";

      const words = data.words.map(w => w.word);
      const energy = data.words.map(w => w.rms);
      const pitch = data.words.map(w => w.pitch);
      const duration = data.words.map(w => w.duration);

      // ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
      drawChart(words, energy, pitch, duration);
    }

    let chart; // Chart ê°ì²´ ì „ì—­

    function drawChart(words, energy, pitch, duration) {
      const ctx = document.getElementById("stressChart").getContext("2d");

      if (chart) chart.destroy(); // ì´ì „ ê·¸ë˜í”„ ì‚­ì œ

      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: words,
          datasets: [
            {
              label: 'ğŸ”Š Energy (RMS)',
              data: energy,
              backgroundColor: 'rgba(255, 99, 132, 0.5)',
              yAxisID: 'yRMS',
            },
            {
              label: 'ğŸµ Pitch (Hz)',
              data: pitch,
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              yAxisID: 'yPitch',
            },
            {
              label: 'â±ï¸ Duration (s)',
              data: duration,
              backgroundColor: 'rgba(255, 206, 86, 0.5)',
              yAxisID: 'yDuration',
            },
          ]
        },
        options: {
    responsive: true,
    scales: {
      yRMS: {
        type: 'linear',
        position: 'left',
        title: { display: true, text: 'RMS' }
      },
      yPitch: {
        type: 'linear',
        position: 'right',
        title: { display: true, text: 'Pitch (Hz)' },
        grid: { drawOnChartArea: false }
      },
      yDuration: {
        type: 'linear',
        position: 'right',
        title: { display: true, text: 'Duration (s)' },
        grid: { drawOnChartArea: false }
      }
    },
    plugins: {
      legend: { position: 'top' },
      title: {
        display: true,
        text: 'ë‹¨ì–´ë³„ ê°•ì„¸ ë¶„ì„ (RMS / Pitch / Duration)'
      }
    }
  }
});
    }
  </script>
</body>
</html>
